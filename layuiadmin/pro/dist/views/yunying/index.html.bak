<div class="layui-fluid">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md8">
      <div class="layui-row layui-col-space15">
 
        <div class="layui-col-md12">
          <div class="layui-card">
            <div class="layui-card-header">一月数据趋势</div>
            <div class="layui-card-body">
              
              <div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade" lay-filter="LAY-index-dataview">
                <div carousel-item id="LAY-index-dataview">
                  <!--<div><i class="layui-icon layui-icon-loading1 layadmin-loading"></i></div>
                  <div></div>-->
                  <div></div>
                </div>
              </div>
              
            </div>
          </div>
        
          
     <div class="layui-card">
      <div class="layui-form layui-card-header layuiadmin-card-header-auto" lay-filter="app-content-list">
        <div class="layui-form-item">
          <div class="layui-inline">
            <label class="layui-form-label">日期</label>
            <div class="layui-input-inline">
              <input type="text" name="date" id="date" placeholder="可不选" class="layui-input">
            </div>
          </div>
          <div class="layui-inline">
            <label class="layui-form-label">IP</label>
            <div class="layui-input-inline">
              <input type="text" name="ip" id="ip" placeholder="可不填" autocomplete="off" class="layui-input">
            </div>
          </div>
          <div class="layui-inline">
            <label class="layui-form-label">内容</label>
            <div class="layui-input-inline">
              <input type="text" name="content" id="content" placeholder="可不填" autocomplete="off" class="layui-input">
            </div>
          </div>
         
          <div class="layui-inline">
            <button class="layui-btn layuiadmin-btn-list" lay-submit lay-filter="LAY-app-contlist-search">
              <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="layui-card-body">    
        <table id="LAY-app-content-list" lay-filter="LAY-app-content-list"></table>         
      </div>
    </div>
    
          
        </div>
      </div>
    </div>
    
    
     <div class="layui-col-md4">
     	       	
       	<div class="layui-card">
        <div class="layui-card-header">十大IP排行图</div>
        <div class="layui-card-body">
          
          <div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade" lay-filter="LAY-index-normbar">
            <div carousel-item id="LAY-index-normbar">
              <div><i class="layui-icon layui-icon-loading1 layadmin-loading"></i></div>
            </div>
          </div>

       </div>
       </div>       
          
     </div>
     
    
    <div class="layui-col-md4">     
    	
    	<div class="layui-card">
        <div class="layui-card-header">十大IP列表</div> 
        <div class="layui-card-body" style="padding: 48px 15px;">
          <table id="LAY-home-homepage-console"></table>
        </div>
      </div>
     

      
    </div>
    
  </div>
</div>

 <script src="util.js"> </script>

<script type="text/javascript">
	var layer = layui.layer;
	var $ = jQuery = layui.jquery;
	var  element = layui.element;
  var form = layui.form;
  var topx =[];
  var topy = [];
  var x2data = [];
  var y2data = [];
    
  var token = CoreUtil.getStok("token");
	if (token == undefined || token == null || token.length < 32 )
	    token = "12345";
  var id =  getid(); 
  var tablename = "/bigdata/table" + id  + ".json?token="+ token;	 
   
  function getid() { 
  	 
  	 var   str = "abcdefgh" + window.location;
     var   i = str.indexOf("table");
     
     if   (i < 0)
           return "0";
                                 
     var   out = str.substr(i + 5,1);
           return out;
  }
 
  	    
  function GetQueryString(name) { 
     var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i"); 
     var r = window.location.search.substr(1).match(reg); 
     if (r!=null) return (r[2]); return null; 
  } 
    
  form.render(null, 'app-content-list');
  //搜索
  form.on('submit(LAY-app-contlist-search)', function(data){
      var field = data.field;
      
      //执行重载
      table.reload('LAY-app-content-list', {
        where: field
      });      
      
      if ($("#date").val() != "") {      
          window.location.reload();
      }
    });
	

	function abc() {
	    CoreUtil.sendAjax(tablename,null,function (res) {	
	               
            if (res.data != null){  
            	  loadTop();
            	  
                loadTable(tablename,"#LAY-app-content-list",res.data,res.title);  
                  
                table.reload('LAY-home-homepage-console', {
                    elem: '#LAY-home-homepage-console'
                    ,data: res.top10
                });
                 
                topx = res.topx;
                topy = res.topy; 
            }  
            
            if (res.x2data != null){  
            	  x2data = res.x2data;
            }   
            
             if (res.y2data != null){  
            	  y2data = res.y2data;
            }                  

            
      },"GET",false);
	}
	

	//abc();
	//setInterval(abc,300000);


  layui.use('yunying', layui.factory('yunying'));

	var table = (layui.$, layui.table);
	//渲染table
  var loadTable = function (myurl,myelem,data,title) {    
      var content="content1";
      var j = 0;
      var cols_arr=new Array();
      
      cols_arr[0] = [];
      cols_arr[0][0] = {type: "numbers",fixed: "left"};
      cols_arr[0][1] = {
				  field: "time",title: "时间",sort: !0,	minWidth: 100				  
			};			
      cols_arr[0][2] = {field: "src_ip",title: "IP地址",minWidth: 100,	sort: !0,
      	  templet: '<div><a href="/webpages/index.html?trace-log&sip={{ d.src_ip }}" target="_blank" class="layui-table-link">{{ d.src_ip }}</div>'
      	 // templet: '<div><a lay-href="/yunying/?table'+ id +'"class="layui-table-link">{{ d.src_ip }}</div>'     
      	};
      cols_arr[0][3] = {field: "geoip",title: "地理位置",minWidth: 100};   

      title.forEach(function(value,i){
            if (title[i].length != 0) {
            	 content = "content" + (i + 1);
            	 j++;              
            	 cols_arr[0][3+j] = {field:content, title: title[i], minWidth: 100};                           
            }
              
      });
      
   
      
      table.render({
                elem: myelem
                ,url: myurl             
                ,page: !0
                ,cellMinWidth: 120
                , cols: cols_arr
                ,height: '480'
                ,skin: "line"               
            });
            
      //cols_arr.length = 0;
  };

  
   var loadTop = function () {  
      
      table.render({
                elem: "#LAY-home-homepage-console"
                ,height: '438'     
                ,data:[]
                ,cols: [[
								{
									type: "numbers",
									fixed: "left",
									width: 50
								},
								{
									field: "src_ip",
									title: "IP地址",
									width: 150,
									templet: '<div><a href="/webpages/index.html?trace-log&sip={{ d.src_ip }}" target="_blank" class="layui-table-link">{{ d.src_ip }}</div>'
								},
								{
									field: "geoip",
									title: "地理位置",			
								},
								{
									field: "count",
									title: "访问次数",			
								}/*,
								{
									field: "risk",
									title: "风险等级",
									width: 60,
									templet: function(e) {
										return "中" == e.risk ? '<del style="color: #5FB878;">' + e.risk + "</del>": "高" == e.risk ? '<span style="color: #FFB800;">' + 
										       e.risk + "</span>": '<span style="color: #FF5722;">' + e.risk + "</span>"
									}
								}*/]],
								skin: "line"          
    });
            
   
  };
     
        


</script>

