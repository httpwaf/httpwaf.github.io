<div class="layui-fluid">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md7">
      <div class="layui-row layui-col-space15">
 
        <div class="layui-col-md12">
          <div class="layui-card">
            <div class="layui-card-header">一月风控数据趋势</div>
            <div class="layui-card-body">
              
              <div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade" lay-filter="LAY-index-dataview">
                <div carousel-item id="LAY-index-dataview">
                  <!--<div><i class="layui-icon layui-icon-loading1 layadmin-loading"></i></div>
                  <div></div>-->
                  <div></div>
                </div>
              </div>
              
            </div>
          </div>
        
          
     <div class="layui-card">
     	<div class="layui-card-header">异常事件监测</div> 

      <div class="layui-card-body">    
        <table id="LAY-app-content-list" lay-filter="LAY-app-content-list"></table>         
      </div>
    </div>
    
          
        </div>
      </div>
    </div>
    
    
     <div class="layui-col-md5">   
    	<div class="layui-card">
        <div class="layui-card-header">系统管理员风控监测</div> 
        <div class="layui-card-body">
          <table id="LAY-home-homepage-admin"></table>
        </div>
      </div>      
    </div>
     
    
    <div class="layui-col-md5">   
    	<div class="layui-card">
        <div class="layui-card-header">用户风控监测</div> 
        <div class="layui-card-body">
          <table id="LAY-home-homepage-user"></table>
        </div>
      </div>      
    </div>
    
  </div>
</div>

 <script src="util.js"> </script>

<script type="text/javascript">
	var layer = layui.layer;
	var $ = jQuery = layui.jquery;
	var  element = layui.element;
  var form = layui.form;
  var topx =[];
  var topy = [];
  var x2data = [];
  var y2data = [];  
  
  var token = CoreUtil.getStok("token");
	if (token == undefined || token == null || token.length < 32 )
	    token = "12345";
	    
  var tablename = "/bigdata/ai_risk.json?token=" + token;
  var adminname = "/bigdata/admin_risk.json?token=" + token;	
  var username = "/bigdata/user_risk.json?token=" + token;	  	    

    
  form.render(null, 'app-content-list');
  //搜索
  form.on('submit(LAY-app-contlist-search)', function(data){
      var field = data.field;
      
      //执行重载
      table.reload('LAY-app-content-list', {
        where: field
      });      
      
      if ($("#date").val() != "") {      
          window.location.reload();
      }
    });
	

	function abc() {
	    CoreUtil.sendAjax(tablename,null,function (res) {	
	               
            if (res.data != null){  
            	  loadTop();
            	  loadAdmin(adminname,"#LAY-home-homepage-admin",res.data);
            	  loadUser(username,"#LAY-home-homepage-user");
                loadTable(tablename,"#LAY-app-content-list");  
                  
               /* table.reload('LAY-home-homepage-console', {
                    elem: '#LAY-home-homepage-console'
                    ,data: res.top10
                });
                 
                topx = res.topx;
                topy = res.topy; */
            }  
            
            if (res.x2data != null){  
            	  x2data = res.x2data;
            }   
            
             if (res.y2data != null){  
            	  y2data = res.y2data;
            }                  

            
      },"GET",false);
	}
	

	abc();
	//setInterval(abc,300000);


  layui.use('airisk', layui.factory('airisk'));

	var table = (layui.$, layui.table);
	//渲染table
  var loadTable = function (myurl,myelem,data) {       
      table.render({
                elem: myelem
                ,url: myurl             
                ,page: !0               
                ,height: '480'
                ,cols: [[
								{
									type: "numbers"	,title: "编号",width: 50							
								},
								{
									field: "time",title: "时间",sort: !0	,width: 120
								},
								{
									field: "src_ip",
									title: "IP地址",	sort: !0,	width: 150,
									templet: '<div><a href="/webpages/index.html?trace-log&sip={{ d.src_ip }}" target="_blank" class="layui-table-link">{{ d.src_ip }}</div>'					
								},						
								{
									field: "geoip",	title: "地理位置",	width: 150,
								},	
								{
									field: "msg",	title: "事件"
								},	
								{
									field: "url",	title: "内容"
								},						
								{
									field: "risk",title: "风险等级",width: 100	,						
									templet: function(e) {
										return "中" == e.risk ? '<del style="color: #5FB878;">' + e.risk + "</del>": "高" == e.risk ? '<span style="color: #FFB800;">' + 
										       e.risk + "</span>": '<span style="color: #FF5722;">' + e.risk + "</span>"
									}
								}]]
                ,skin: "line"               
            });

  };
  
  var loadAdmin = function (myurl,myelem) {       
      table.render({
                elem: myelem
                ,url: myurl             
                ,page: !0               
                ,height: '330'
                ,cols: [[							
								{
									field: "time",title: "时间",sort: !0	,width: 125
								},
								{
									field: "src_ip",
									title: "IP地址",	sort: !0,	width: 138,
									templet: '<div><a href="/webpages/index.html?trace-log&sip={{ d.src_ip }}" target="_blank" class="layui-table-link">{{ d.src_ip }}</div>'					
								},						
								{
									field: "geoip",	title: "地理位置",	width: 120,
								},	
								{
									field: "msg",	title: "事件"
								},	
								{
									field: "url",	title: "用户名"
								},						
								{
									field: "risk",title: "风险",width: 60	,						
									templet: function(e) {
										return "中" == e.risk ? '<del style="color: #5FB878;">' + e.risk + "</del>": "高" == e.risk ? '<span style="color: #FFB800;">' + 
										       e.risk + "</span>": '<span style="color: #FF5722;">' + e.risk + "</span>"
									}
								}]]
                ,skin: "line"               
            });

  };
  
  var loadUser = function (myurl,myelem) {       
      table.render({
                elem: myelem
                ,url: myurl             
                ,page: !0               
                ,height: '480'
                ,cols: [[							
								{
									field: "time",title: "时间",sort: !0	,width: 125
								},
								{
									field: "src_ip",
									title: "IP地址",	sort: !0,	width: 138,
									templet: '<div><a href="/webpages/index.html?trace-log&sip={{ d.src_ip }}" target="_blank" class="layui-table-link">{{ d.src_ip }}</div>'					
								},						
								{
									field: "geoip",	title: "地理位置",	width: 120,
								},	
								{
									field: "msg",	title: "事件"
								},	
								{
									field: "url",	title: "用户名"
								},						
								{
									field: "risk",title: "风险",width: 60	,						
									templet: function(e) {
										return "中" == e.risk ? '<del style="color: #5FB878;">' + e.risk + "</del>": "高" == e.risk ? '<span style="color: #FFB800;">' + 
										       e.risk + "</span>": '<span style="color: #FF5722;">' + e.risk + "</span>"
									}
								}]]
                ,skin: "line"               
            });

  };


  
   var loadTop = function () {  
      
      table.render({
                elem: "#LAY-home-homepage-console",             
	              data:[],
		            cols: [[
								{
									type: "numbers",
									fixed: "left",
									width: 50
								},
								{
									field: "src_ip",
									title: "IP地址",
									width: 150
								},
								{
									field: "geoip",
									title: "地理位置",			
								},
								{
									field: "count",
									title: "访问次数",			
								}/*,
								{
									field: "risk",
									title: "风险等级",
									width: 60,
									templet: function(e) {
										return "中" == e.risk ? '<del style="color: #5FB878;">' + e.risk + "</del>": "高" == e.risk ? '<span style="color: #FFB800;">' + 
										       e.risk + "</span>": '<span style="color: #FF5722;">' + e.risk + "</span>"
									}
								}*/]],
								skin: "line"          
    });
            
   
  };
     
        


</script>

